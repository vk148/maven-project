pipeline {
    agent any
tools {
    maven 'localmaven'
  }    
stages{
		stage('Init'){
            steps {
				echo 'Initialized'
            }
            post {
                success {
                    echo 'Success'
                }
            }
        }
        stage('Build'){
            steps {
				echo 'Building'
				mvn clean package
			}
            success {
                    echo 'Now Archiving...'
                    archiveArtifacts artifacts: '**/target/*.war'
            }
        }
		stage('Static Analysis'){
            steps {
				echo 'Static Analysis'
				mvn checkstyle:checkstyle
            }
            post {
                success {
                    echo 'Static Analysis completed'
                }
            }
        }
		stage('Test'){
            steps {
				echo 'Testing'
				mvn test
            }
            post {
                success {
                    echo 'Test completed'
                }
            }
        }
		stage('Deploy to staging'){
            steps {
				echo 'Deploy to staging'
				build job: deploy-to-staging
            }
            post {
                success {
                    echo 'Deploy to staging completed'
                }
            }
        }
		stage('Deploy to production'){
            steps {
				timeout(times:5, unit:'DAYS'){
					input message: 'Approve PRODUCTION deployment', submitter: Admin
				}
				build job: deploy-to-production
            }
            post {
                success {
                    echo 'deploy to production completed'
                }
				failure {
					echo ' deployment failed.'
				}
            }
        }
    }
}